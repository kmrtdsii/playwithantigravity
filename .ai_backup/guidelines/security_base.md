# Security Best Practices for Antigravity Agents

> [!IMPORTANT]
> Security is not a feature; it is a fundamental requirement. As an AI Agent, you must be vigilant about potential vulnerabilities in code you generate or modify.

## 1. Input Validation & Sanitization
*   **Trust No One**: Treat all external input (user input, API responses, file contents) as potentially malicious.
*   **Validate Early**: Validate data types, formats, and lengths at the boundary (e.g., API handlers, CLI arguments).
*   **Sanitize**: Escape output to prevent Injection attacks (SQLi, XSS, Command Injection).
    *   *Go*: Use `html/template` for HTML output. Use parameterized queries for SQL (`db.Query("...", arg)`, NEVER `fmt.Sprintf`).
    *   *Frontend*: React automatically escapes content, but be careful with `dangerouslySetInnerHTML`.

## 2. Secrets Management
*   **Zero Tolerance**: NEVER commit secrets (API keys, passwords, private keys) to the git history.
*   **Detection**: If you see a hardcoded secret in the codebase, your IMMEDIATE priority is to move it to an environment variable (`.env`) and add the file to `.gitignore`.
*   **Environment Variables**: pattern `process.env.SECRET` (Node) or `os.Getenv("SECRET")` (Go).

## 3. Authorization & Access Control
*   **Least Principle**: Components should only have the permissions they absolutely need.
*   **Backend Enforced**: Never rely on frontend logic for security. Always verify permissions on the server.

## 4. GenAI Native Security
*   **Context Hygiene**: When analyzing files, be careful not to unnecessarily expose sensitive user data in your chain-of-thought or context window if strictly not needed.
*   **generated Code**: Code generated by AI (including you) can be insecure. Always review your own code for common vulnerabilities before finalizing.

## 5. Dependency Safety
*   **Review Imports**: When adding new libraries, verify they are reputable and maintained.
*   **Lockfiles**: Always commit `package-lock.json` or `go.sum` to ensure deterministic builds.

## 6. History Remediation
*   **Scenario**: Changes needing removal from the entire history (e.g., secrets, large binaries).
*   **Tool**: Use `git-filter-repo` (Python-based). It is significantly faster and safer than `git filter-branch`.
*   **Prerequisite**: `brew install git-filter-repo` (requires `python3`).
*   **Procedure**:
    1.  **Backup**: Create a local backup branch: `git checkout -b backup/pre-filter`.
    2.  **Execute**: Run the filter command (e.g., to remove a file):
        ```bash
        git filter-repo --path path/to/secret --invert-paths --force
        ```
    3.  **Restore Remote**: The tool automatically removes remotes for safety. Restore it:
        ```bash
        git remote add origin <remote_url>
        ```
    4.  **Verification**: Check log: `git log --all --name-status -- path/to/secret`.
    5.  **Finalize**: Force push the rewritten branch: `git push origin main --force`.
